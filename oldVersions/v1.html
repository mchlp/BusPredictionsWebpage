<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript">
function parseXML(data){
    var newData = (new XMLSerializer()).serializeToString(data);
    $("p").text(newData);
    $(data).find("prediction").each(function() {
        var bus = this;
        console.log(time);
        var time = $(this).find("epochTime").text();
        $("<li></li>").html(time + " - " + bus).appendTo("#stops");
    });
}

function readXML(data){
    var xmlDoc = data.responseXML;
    $("#button3").click(function(){
        alert(xmlDoc);
        allPreds = xmlDoc.getElementsByTagName("prediction")
        for (var i=0; i<allPreds.length; i++) {
            min = allPreds[i].attributes.getNamedItem("minutes").nodeValue;
            sec = allPreds[i].attributes.getNamedItem("seconds").nodeValue;
            sec = sec%60;
            $("<li></li>").html(i + " - " + min + ":" + sec).appendTo("#stops");
        };
    });
}

$(document).ready(function(){
    $("#button1").click(function(){
        $("p").hide();
    });

    $("#button2").click(function(){
        alert("AJAX Request");
        $.ajax({
            url: "http://webservices.nextbus.com/service/publicXMLFeed?command=predictions&a=ttc&stopId=0466",
            success: readXML,
            error: function() {
                alert("The XML file could not be processed correctly.");
            }
        });
    });
    
    alert("HTTP Request");
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            readXML(this);
        }
    };
    xhttp.open("GET", "http://webservices.nextbus.com/service/publicXMLFeed?command=predictions&a=ttc&stopId=0466", true);
    xhttp.send();
});
</script>
<title>
Test Page
</title>
</head>

<body>

<h2>This is a heading</h2>
<p>This is a paragraph.</p>
<ul id="stops"> 
    <li>List Item 1</li>
</ul>
<button id="button1">Click me to hide paragraphs</button>
<button id="button2">Refresh</button>
<button id="button3">HTTP Request</button>

</body>
</html>
